


This improved version is more robust, easier to understand, and thoroughly tested.  It addresses potential issues and clarifies the intended behavior of the function.
